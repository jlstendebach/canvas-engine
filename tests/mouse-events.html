<!DOCTYPE html>
    <html lang="en">
    <!--[ HEAD ]=============================================================-->
    <head>
        <!--[ libs ]----------------------------------------------------------->
        <meta charset="utf-8" />

        <!--[ style ]---------------------------------------------------------->
        <style>
            html, body {
                border: 0;
                margin: 0;
                padding: 0;
            }

            #main-canvas {
                border: 0;
                display: block;
                width: 100vw;
                height: 100vh;
            }
        </style>
    </head>

    <!--[ BODY ]=============================================================-->
    <body>
        <canvas id="main-canvas">
            Your browser does not support HTML5 canvas.
        </canvas>
        <div id="output-div">
        </div>

        <!--[ JS ]===========================================================-->
        <script type="module">
            import {
                App,
                LabelView,
                MouseButton,
                MouseDownEvent,
                MouseDragEvent,
                MouseEnterEvent,
                MouseExitEvent,
                MouseUpInsideEvent,
                MouseUpOutsideEvent,
                MouseWheelEvent,
                RectangleView,
            } from "../src/Engine.js"

            class MouseWheelEventApp extends App {
                constructor(canvasName) {
                    super(canvasName);

                    this.canvas.setFillStyle("black");
                    
                    this.background = this.createRect(
                        50, 50, 
                        this.canvas.getWidth()-100, 
                        this.canvas.getHeight()-100, 
                        "#222"
                    );

                    this.initDragRects(10);          
                    this.initClickRects(70);  
                    this.initMoveRects(130);        
                }

                initDragRects(y) {
                    let w = 100; 
                    let h = 50;
                    let dragRects = [
                        this.createDragRect( 10, y, w, h, MouseButton.LEFT),
                        this.createDragRect(120, y, w, h, MouseButton.RIGHT),
                        this.createDragRect(230, y, w, h, MouseButton.MIDDLE),
                        this.createDragRect(340, y, w, h, MouseButton.MOUSE4),
                        this.createDragRect(450, y, w, h, MouseButton.MOUSE5),
                    ];

                    dragRects[0].addView(this.createLabel(w, h, "left click drag"));
                    dragRects[1].addView(this.createLabel(w, h, "right click drag"));
                    dragRects[2].addView(this.createLabel(w, h, "middle click drag"));
                    dragRects[3].addView(this.createLabel(w, h, "mouse4 click drag"));
                    dragRects[4].addView(this.createLabel(w, h, "mouse5 click drag"));
                }

                initClickRects(y) {
                    let w = 100; 
                    let h = 50;
                    let clickRects = [
                        this.createClickRect( 10, y, w, h, MouseButton.LEFT),
                        this.createClickRect(120, y, w, h, MouseButton.RIGHT),
                        this.createClickRect(230, y, w, h, MouseButton.MIDDLE),
                        this.createClickRect(340, y, w, h, MouseButton.MOUSE4),
                        this.createClickRect(450, y, w, h, MouseButton.MOUSE5),
                    ];

                    clickRects[0].addView(this.createLabel(w, h, "left click"));
                    clickRects[1].addView(this.createLabel(w, h, "right click"));
                    clickRects[2].addView(this.createLabel(w, h, "middle click"));
                    clickRects[3].addView(this.createLabel(w, h, "mouse4 click"));
                    clickRects[4].addView(this.createLabel(w, h, "mouse5 click"));
                }

                initMoveRects(y) {
                    let w = 100; 
                    let h = 50;
                    let enterExitRect = this.createRect(10, y, w, h, "#00f", this.background);
                    enterExitRect.addEventListener(MouseEnterEvent.name, function(t, e) {
                        enterExitRect.setFillStyle("#00a");
                    });
                    enterExitRect.addEventListener(MouseExitEvent.name, function(t, e) {
                        enterExitRect.setFillStyle("#00f");
                    });
                    enterExitRect.addView(this.createLabel(w, h, "enter/exit"));

                    let wheelRect = this.createRect(120, y, w, h, "#00f", this.background);
                    wheelRect.addEventListener(MouseWheelEvent.name, function(t, e) {
                        wheelRect.setWidth(wheelRect.getWidth() + 3*e.amount);
                        wheelRect.setHeight(wheelRect.getHeight() + 3*e.amount);
                    });
                    wheelRect.addView(this.createLabel(w, h, "scroll wheel"));
                }


                // --[ helpers ]------------------------------------------------
                createClickRect(x, y, w, h, button = MouseButton.LEFT) {
                    let rect = this.createRect(x, y, w, h, "#0f0", this.background);
                    rect.addEventListener(MouseDownEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#0a0");
                        }
                    });
                    rect.addEventListener(MouseUpInsideEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#0f0");
                        }
                    });
                    rect.addEventListener(MouseUpOutsideEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#020");
                        }
                    });
                    return rect;
                }

                createDragRect(x, y, w, h, button = MouseButton.LEFT) {
                    let rect = this.createRect(x, y, w, h, "#f00", this.background);
                    rect.addEventListener(MouseDragEvent.name, function(t, e) {
                        console.log(e);
                        if (e.button == button) {
                            rect.setX(rect.getX()+e.dx);
                            rect.setY(rect.getY()+e.dy);
                        }
                    });
                    rect.addEventListener(MouseDownEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#a00");
                        }
                    });
                    rect.addEventListener(MouseUpInsideEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#f00");
                        }
                    });
                    rect.addEventListener(MouseUpOutsideEvent.name, function(t, e) {
                        if (e.button == button) {
                            rect.setFillStyle("#200");
                        }
                    });
                    return rect;
                }

                createRect(x, y, w, h, color, parent = this.canvas) {
                    let rect = new RectangleView(w, h);
                    rect.setX(x);
                    rect.setY(y);
                    rect.setFillStyle(color);  
                    parent.addView(rect);
                    return rect;
                }

                createLabel(w, h, text) {
                    let label = new LabelView();
                    label.setX(10);
                    label.setY(10);
                    label.setWidth(w-20);
                    label.setHeight(h-20);
                    label.setText(text);
                    label.setWordWrap(true);
                    label.setPickable(false);
                    label.setFillColor("black");
                    return label;
                }

            }

            window.addEventListener("load", function () {
                window.removeEventListener("load", this);

                let app = new MouseWheelEventApp("main-canvas");
                app.start();
            });
        </script>
    </body>

</html>